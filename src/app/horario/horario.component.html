<div class="container-fluid px-4 py-3">
  <div class="row">
    <div class="col-12">
      <!-- Header Section -->
      <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
          <h4 class="mb-1 fw-semibold text-dark">Horarios</h4>
          <p class="text-muted small mb-0">Gestión y mantenimiento de horarios laborales</p>
        </div>
      </div>

      <div class="row g-3">
        <!-- Grid Horarios (Cabecera) -->
        <div class="col-lg-6">
          <div class="card border-0 shadow-sm">
            <div class="card-header bg-white border-bottom py-3">
              <h6 class="mb-0 fw-semibold">Horarios</h6>
            </div>
            <div class="card-body p-0">
              <dx-data-grid #dataGrid
                id="gridContainer"
                [dataSource]="horarios"
                keyExpr="nCodigo"
                [showBorders]="false"
                (onRowUpdating)="actualizar($event)"
                (onRowInserted)="insertar($event)"
                (onRowRemoved)="eliminar($event)"
                [showColumnLines]="false"
                [showRowLines]="true"
                [allowColumnResizing]="true"
                [hoverStateEnabled]="true"
                [(selectedRowKeys)]="filasSeleccionadasHorario"
                (onSelectionChanged)="mostrarDetalleHorario($event)"
              >
                <dxo-paging [pageSize]="50"></dxo-paging>
                <dxo-pager
                  [visible]="true"
                  [showPageSizeSelector]="true"
                  [allowedPageSizes]="[50, 100]"
                  [showInfo]="true"
                  infoText="Mostrando {0}-{1} de {2}"
                ></dxo-pager>

                <dxo-editing
                  mode="row"
                  [allowUpdating]="true"
                  [allowAdding]="true"
                  [allowDeleting]="true"
                  [selectTextOnEditStart]="true"
                  startEditAction="click"
                ></dxo-editing>

                <dxo-selection mode="single"></dxo-selection>

                <dxi-column
                  dataField="nCodigo"
                  caption="ID"
                  [width]="70"
                  [allowEditing]="false"
                  alignment="center"
                ></dxi-column>

                <dxi-column
                  dataField="cNombre"
                  caption="Codigo"
                >
                  <dxi-validation-rule type="required"></dxi-validation-rule>
                </dxi-column>

                <dxi-column
                  dataField="cDescripcion"
                  caption="Descripción"
                  [width]="240"
                ></dxi-column>

                <dxi-column
                  dataField="nDiasTrabajo"
                  caption="Días"
                  dataType="number"
                  [width]="80"
                  alignment="center"
                  [setCellValue]="onDiasTrabajoChanged"
                >
                  <dxi-validation-rule
                    type="range"
                    [min]="1"
                    [max]="7"
                    message="Debe ser entre 1 y 7"
                  ></dxi-validation-rule>
                </dxi-column>

             <dxi-column
                  dataField="nRefrigerio"
                  caption="Refrigerio"
                ></dxi-column>
                  <dxi-column
                  dataField="nTraslado"
                  caption="Traslado"
                ></dxi-column>

                <dxi-column
                  type="buttons"
                  [width]="120"
                  alignment="center"
                >
                  <dxi-button name="edit" icon="edit" hint="Editar"></dxi-button>
                  <dxi-button name="delete" icon="trash" hint="Eliminar"></dxi-button>
                  <dxi-button name="save" icon="save" hint="Guardar"></dxi-button>
                  <dxi-button name="cancel" icon="revert" hint="Cancelar"></dxi-button>
                </dxi-column>
              </dx-data-grid>
            </div>
          </div>
        </div>

        <!-- Grid Detalles por Día y Evento -->
        <div class="col-lg-6">
          <div class="card border-0 shadow-sm">
            <div class="card-header bg-white border-bottom py-3 d-flex justify-content-between align-items-center">
              <h6 class="mb-0 fw-semibold">Detalles por Día</h6>
              <small class="text-muted">
                <i class="dx-icon-info"></i> Puede haber 1 o 2 eventos por día
              </small>
            </div>
            <div class="card-body p-0">
              <dx-data-grid #detalleGrid
                [dataSource]="detallesEventos"
                keyExpr="keyUnico"
                [showBorders]="false"
                (onRowUpdating)="actualizarDetalleEvento($event)"
                (onRowInserted)="insertarDetalleEvento($event)"
                (onRowRemoved)="eliminarDetalleEvento($event)"
                [showColumnLines]="false"
                [showRowLines]="true"
                [allowColumnResizing]="true"
                [hoverStateEnabled]="true"
              >
                <dxo-paging [pageSize]="50"></dxo-paging>
                <dxo-pager
                  [visible]="true"
                  [showPageSizeSelector]="true"
                  [allowedPageSizes]="[50,100]"
                  [showInfo]="true"
                  infoText="Mostrando {0}-{1} de {2}"
                ></dxo-pager>

                <dxo-editing
                  mode="form"
                  [allowUpdating]="true"
                  [allowAdding]="true"
                  [allowDeleting]="true"
                  [selectTextOnEditStart]="true"
                  startEditAction="click"
                >
                  <dxo-form [colCount]="2">
                    <dxi-item dataField="diaSemana"></dxi-item>
                    <dxi-item dataField="tipoEvento"></dxi-item>
                    <dxi-item dataField="hora"></dxi-item>
                    <dxi-item dataField="ventanaMin"></dxi-item>
                    <dxi-item dataField="ventanaMax"></dxi-item>
                  </dxo-form>
                </dxo-editing>

                <dxi-column
                  dataField="diaSemana"
                  caption="Día"
                  [width]="120"
                  [groupIndex]="0"
                  [showWhenGrouped]="false"
                >
                  <dxo-lookup
                    [dataSource]="diasSemana"
                    displayExpr="nombre"
                    valueExpr="id"
                  ></dxo-lookup>
                  <dxi-validation-rule type="required"></dxi-validation-rule>
                </dxi-column>

                <dxi-column
                  dataField="tipoEvento"
                  caption="Tipo"
                  [width]="100"
                >
                  <dxo-lookup
                    [dataSource]="tiposEvento"
                    displayExpr="nombre"
                    valueExpr="id"
                  ></dxo-lookup>
                  <dxi-validation-rule type="required"></dxi-validation-rule>
                </dxi-column>

                <dxi-column
                  dataField="hora"
                  caption="Hora"
                  dataType="datetime"
                  [editorOptions]="{ type: 'time' }"
                  format="HH:mm:ss"
                  [width]="100"
                  alignment="center"
                >
                  <dxi-validation-rule type="required"></dxi-validation-rule>
                </dxi-column>

                <dxi-column
                  dataField="ventanaMin"
                  caption="Vent. Min"
                  dataType="number"
                  [width]="90"
                  alignment="center"
                >
                  <dxi-validation-rule type="required"></dxi-validation-rule>
                </dxi-column>

                <dxi-column
                  dataField="ventanaMax"
                  caption="Vent. Max"
                  dataType="number"
                  [width]="90"
                  alignment="center"
                >
                  <dxi-validation-rule type="required"></dxi-validation-rule>
                </dxi-column>

                <dxi-column
                  type="buttons"
                  [width]="120"
                  alignment="center"
                >
                  <dxi-button name="edit" icon="edit" hint="Editar"></dxi-button>
                  <dxi-button name="delete" icon="trash" hint="Eliminar"></dxi-button>
                  <dxi-button name="save" icon="save" hint="Guardar"></dxi-button>
                  <dxi-button name="cancel" icon="revert" hint="Cancelar"></dxi-button>
                </dxi-column>
              </dx-data-grid>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <block-ui></block-ui>
</div>
